/* MEDIA CONTROLS */
#zen-media-controls-toolbar>toolbaritem {
    backdrop-filter: saturate(1) contrast(0) blur(10px) !important;
    background-color: var(--na-color-bg) !important;
    border-color: var(--na-color-border) !important;
    border-width: 2px !important;
    border-style: solid !important;
    border-radius: var(--na-tab-border-radius) !important;
    margin-bottom: 14px !important; /* Remove if workspace nav is at top */
}

/* Fix overflow issue only */
#zen-media-info-vbox {
    min-width: 0 !important;
    overflow: hidden !important;
}

#zen-media-info-container {
    overflow: hidden !important;
    min-width: 0 !important;
}

/* hide elements */
@media (-moz-bool-pref: "wireframe.player.minimal"){
  #zen-media-pip-button,
  #zen-media-mute-button,
  #zen-media-mute-mic-button,
  #zen-media-mute-camera-button {
      display: none !important;
  }

  #zen-media-controls-hbox {
      display: flex !important;
      justify-content: center !important; /* center all children horizontally */
      align-items: center !important;     /* vertically center */
  }

  #zen-media-controls-hbox toolbarbutton[style*="display: none"] {
      width: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
  }
}

@media (-moz-bool-pref: "wireframe.player.flip"){
  /* Always show title and progress */
  #zen-media-info-vbox,
  #zen-media-controls-toolbar .show-on-hover {
      max-height: unset !important;
      opacity: 1 !important;
      transform: translateY(0) !important;
      pointer-events: none; /* don't block clicks */
      transition: max-height 0.2s ease, opacity 0.2s ease, transform 0.2s ease;
  }

  /* Hide controls by default */
  #zen-media-buttons-hbox,
  #zen-media-controls-hbox {
      max-height: 0 !important;
      opacity: 0 !important;
      overflow: hidden !important;
      pointer-events: none !important;
      transition: max-height 0.2s ease, opacity 0.2s ease, transform 0.2s ease;
  }

  /* Show controls on hover */
  #zen-media-controls-toolbar:hover #zen-media-buttons-hbox,
  #zen-media-controls-toolbar:hover #zen-media-controls-hbox {
      max-height: 32px !important; /* adjust to your button row height */
      opacity: 1 !important;
      overflow: visible !important;
      pointer-events: auto !important;
  }
  
  /* change gradient color */
  #zen-media-info-vbox:before{
    background: linear-gradient(to right, var(--na-color-bg) 0%, transparent 100%) !important;
  }

}



/*Credit: JustAdumbPrson*/
@-moz-document url-prefix("chrome:") {
  /* Add rounded corners to player holder */
  .player-holder {
    border-radius: 7.6px !important; /* Adjust the radius as needed */
  }
  
  /* ------------------------- Picture in Picture ------------------------- */
  
  @media not -moz-pref("wireframe.pip.disabled") {
    @-moz-document url("chrome://global/content/pictureinpicture/player.xhtml") {
      /*noinspection CssInvalidFunction*/
      * {
        /* Wireframe theme colors - using existing variables */
        --wf-pip-bg: var(--na-color-bg);
        --wf-pip-border: var(--na-color-border);
        --wf-pip-text: var(--na-color-text);
        --wf-pip-control-bg: var(--na-color-bg);
        --wf-pip-control-hover: var(--na-color-text-second);
        --wf-pip-control-active: var(--na-color-bg-second);
        --wf-pip-blur-radius: 10px;
        --wf-pip-control-radius: 0px;
        --wf-pip-saturation: 1;
        --wf-pip-contrast: 1;
        
        --toolbarbutton-hover-background: var(--wf-pip-control-hover);
        --toolbarbutton-active-background: var(--wf-pip-control-active);
      }
  
      @keyframes pip-fadein-html {
        0% {
          background-color: transparent;
          scale: 0.8;
        }
  
        99% {
          background-color: transparent;
          scale: 1;
        }
  
        100% {
          background-color: black;
        }
      }
  
      @keyframes pip-fadein-player {
        0% {
          filter: blur(30px);
          opacity: 0;
        }
  
        70% {
          filter: blur(5px);
        }
  
        100% {
          filter: blur(0);
          opacity: 1;
        }
      }
  
      @media -moz-pref("wireframe.pip.rounded") {
        /* This won't work on Linux (sadly), might be just a Gnome thing. */
        /* If you're seeing this, create an issue if it does indeed work */
  
        @media (-moz-platform: windows) {
          window, html, body {
            /* Share same radius as macOS for the sake of simplicity later */
            border-radius: 9px !important;
          }
        }
      }
  
      html {
        animation: pip-fadein-html 0.5s ease !important;
      }
  
      .player-holder {
        animation: pip-fadein-player 0.5s ease !important;
        clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
      }
  
      #controls {
        opacity: 1 !important;
  
        /*noinspection CssInvalidFunction*/
        & > button {
          opacity: 0 !important;
          top: 0 !important;
          filter: blur(5px);
          border-radius: var(--wf-pip-control-radius) !important;
          transition: opacity 0.3s ease, top 0.3s ease, filter 0.3s ease, background-color 0.2s ease !important;
          backdrop-filter: saturate(var(--wf-pip-saturation)) contrast(var(--wf-pip-contrast)) blur(var(--wf-pip-blur-radius)) !important;
          background-image: none !important;
          background-color: var(--wf-pip-control-bg) !important;
          box-shadow: none !important;
          border: 1px solid var(--wf-pip-border) !important;
  
          &::before {
            content: "";
            width: 16px;
            height: 16px;
            padding: 2px;
            display: flex;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            align-content: center;
            justify-content: center;
            fill: var(--wf-pip-text) !important;
          }
  
          &#close::before {
            content: url("chrome://browser/skin/zen-icons/close.svg") !important;
          }
  
          &#minimize::before {
            content: url("chrome://browser/skin/zen-icons/unpin.svg") !important;
          }
  
          &#unpip::before {
            content: url("chrome://browser/skin/zen-icons/screen.svg") !important;
          }
  
          &:hover {
            background-color: var(--wf-pip-control-hover) !important;
          }
        }
  
        #controls-bottom-gradient {
          display: none !important;
        }
  
        /*noinspection CssInvalidFunction*/
        #controls-bottom {
          opacity: 0 !important;
          bottom: -5px !important;
          background-color: var(--wf-pip-control-bg) !important;
          border-radius: var(--wf-pip-control-radius) !important;
          padding: 10px 15px !important;
          margin: 0 5px !important;
          margin-bottom: 5px !important;
          width: min(calc(100% - 10px), 700px) !important;
          box-sizing: border-box !important;
          box-shadow: none !important;
          backdrop-filter: saturate(var(--wf-pip-saturation)) contrast(var(--wf-pip-contrast)) blur(var(--wf-pip-blur-radius)) !important;
          filter: blur(10px);
          transition: opacity 0.3s ease, bottom 0.3s ease, filter 0.3s ease !important;
          border: 1px solid var(--wf-pip-border) !important;
          left: calc(50% - 5px) !important;
          transform: translateX(-50%) !important;
  
          @media -moz-pref("wireframe.pip.rounded") and (width <= 710px) {
            /* For the sake of adding native radius, we'll reduce the margin of the controls here */
            width: min(100%, 700px) !important;
            margin: 0 !important;
            left: calc(50%) !important;
            bottom: -10px !important;
  
            /*
            For now this config is available on macOS only, this'll be added to Windows and Linux
            once curved PiP for those platforms moves out of experiment status
            */
            @media (-moz-platform: macos) {
              border-radius: var(--wf-pip-control-radius) !important;
            }
          }
  
          .start-controls {
            @media (width > 300px) {
              display: flex !important;
            }
  
            /*noinspection CssInvalidFunction*/
            #timestamp {
              font-size: 12px !important;
              color: var(--wf-pip-text) !important;
            }
          }
  
          .end-controls {
            display: flex !important;
          }
  
          #scrubber, #audio-scrubber {
            margin: 0 !important;
  
            /*noinspection CssInvalidFunction*/
            #scrubber::-moz-range-progress {
              background: var(--wf-pip-text) !important;
            }
  
            /*noinspection CssInvalidFunction*/
            &::-moz-range-track {
              background-color: var(--wf-pip-control-hover) !important;
            }
  
            /*noinspection CssInvalidFunction*/
            &::-moz-range-thumb {
              background: var(--wf-pip-text) !important;
              width: 12px !important;
              height: 12px !important;
              border: 1px solid var(--wf-pip-border) !important;
            }
          }
  
          #audio-scrubber {
            &::-moz-range-thumb {
              width: 8px !important;
              height: 8px !important;
              opacity: 1 !important;
            }
          }
  
          /*noinspection CssInvalidFunction*/
          button {
            opacity: 1 !important;
            position: relative;
            padding: 6px !important;
            background-size: 16px !important;
            width: 28px !important;
            height: 28px !important;
            border-radius: var(--wf-pip-control-radius) !important;
            transition: background-color 0.2s ease !important;
            -moz-context-properties: fill;
            fill: var(--wf-pip-text) !important;
  
            &[disabled] {
              cursor: default !important;
              fill-opacity: 0.4 !important;
  
              &::after {
                display: none !important;
              }
            }
  
            &:not([disabled]) {
              &:hover {
                background-color: var(--toolbarbutton-hover-background) !important;
              }
  
              &:active {
                background-color: var(--toolbarbutton-active-background) !important;
              }
            }
  
            &#playpause {
              background-image: url("chrome://browser/skin/zen-icons/media-play.svg") !important;
            }
  
            &#audio {
              background-image: url("chrome://browser/skin/zen-icons/media-unmute.svg") !important;
            }
  
            &#seekBackward {
              background-image: url("chrome://browser/skin/zen-icons/reload.svg") !important;
              scale: -1 1;
  
              &::before {
                content: "5";
                font-size: 8px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(50%, -50%);
                scale: -1 1;
              }
  
              &::after {
                scale: -1 1;
              }
            }
  
            &#seekForward {
              background-image: url("chrome://browser/skin/zen-icons/reload.svg") !important;
  
              &::before {
                content: "5";
                font-size: 8px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
              }
            }
  
            &#fullscreen {
              background-image: url("chrome://browser/skin/zen-icons/fullscreen.svg") !important;
            }
          }
  
          .controls-bottom-upper {
            margin: 0 !important;
            margin-bottom: 5px !important;
            width: 100% !important;
            height: fit-content !important;
  
            .scrubber-no-drag {
              margin: 0 !important;
            }
  
            &:has(#scrubber[hidden]) {
              display: none !important;
              margin: 0 !important;
            }
          }
  
          .controls-bottom-lower {
            margin: 0 !important;
          }
        }
  
        #settings {
          bottom: 80px !important;
          right: 0 !important;
          display: block !important;
          transition: opacity 0.3s ease, bottom 0.3s ease !important;
  
          .arrow {
            display: none !important;
          }
  
          /*noinspection CssInvalidFunction*/
          label, legend {
            font-family: system-ui !important;
            color: var(--wf-pip-text) !important;
          }
  
          /*noinspection CssInvalidFunction*/
          .slider {
            background-color: var(--wf-pip-control-hover) !important;
            outline: 1px solid var(--wf-pip-border) !important;
  
            /*noinspection CssInvalidFunction*/
            &::before {
              background-color: var(--wf-pip-border) !important;
            }
          }
  
          input {
            /*noinspection CssInvalidFunction*/
            &:checked {
              border-color: var(--wf-pip-border) !important;
            }
  
            /*noinspection CssInvalidFunction*/
            &:checked + .slider {
              background-color: var(--wf-pip-text) !important;
              outline-color: var(--wf-pip-border) !important;
  
              &::before {
                background-color: var(--wf-pip-bg) !important;
              }
            }
          }
  
          /*noinspection CssInvalidFunction*/
          & > .panel-fieldset {
            background-color: var(--wf-pip-control-bg) !important;
            backdrop-filter: saturate(var(--wf-pip-saturation)) contrast(var(--wf-pip-contrast)) blur(var(--wf-pip-blur-radius));
            filter: blur(0);
            transition: backdrop-filter 0.3s ease, filter 0.3s ease;
            border: 1px solid var(--wf-pip-border) !important;
            box-shadow: none !important;
            padding: 0 !important;
          }
  
          /*noinspection CssInvalidFunction*/
          .grey-line {
            width: calc(100% - 10px) !important;
            margin: 0 auto !important;
            background-color: var(--wf-pip-border) !important;
          }
  
          &.hide {
            bottom: 70px !important;
            opacity: 0 !important;
            pointer-events: none !important;
  
            & > .panel-fieldset {
              backdrop-filter: none !important;
              filter: blur(5px);
            }
          }
        }
  
        &.muted {
          #controls-bottom {
            #audio {
              background-image: url("chrome://browser/skin/zen-icons/media-mute.svg") !important;
            }
          }
        }
  
        &.playing {
          #controls-bottom {
            #playpause {
              background-image: url("chrome://browser/skin/zen-icons/media-pause.svg") !important;
            }
          }
        }
      }
  
      body:fullscreen #controls[showing]:hover, body:not(:fullscreen) #controls:hover {
        & > button {
          opacity: 1 !important;
          top: 10px !important;
          filter: blur(0) !important;
        }
  
        #controls-bottom {
          opacity: 1 !important;
          bottom: 5px !important;
          filter: blur(0);
  
          @media -moz-pref("wireframe.pip.rounded") {
            bottom: 0 !important;
          }
        }
      }
  
      body:fullscreen {
        &:has(#controls:not([showing])) {
          cursor: none !important;
        }
  
        #controls {
          #controls-bottom {
            #fullscreen {
              background-image: url("chrome://browser/skin/zen-icons/fullscreen-exit.svg") !important;
            }
          }
        }
      }
    }
  }
}

/* === Picture-in-Picture Border Radius Preferences === */
@media (-moz-pref("wireframe.pip.border_radius", 0)) {
  @-moz-document url("chrome://global/content/pictureinpicture/player.xhtml") {
    * {
      --wf-pip-control-radius: 0px;
    }
  }
}

@media (-moz-pref("wireframe.pip.border_radius", 4)) {
  @-moz-document url("chrome://global/content/pictureinpicture/player.xhtml") {
    * {
      --wf-pip-control-radius: 4px;
    }
  }
}

@media (-moz-pref("wireframe.pip.border_radius", 6)) {
  @-moz-document url("chrome://global/content/pictureinpicture/player.xhtml") {
    * {
      --wf-pip-control-radius: 6px;
    }
  }
}

@media (-moz-pref("wireframe.pip.border_radius", 8)) {
  @-moz-document url("chrome://global/content/pictureinpicture/player.xhtml") {
    * {
      --wf-pip-control-radius: 8px;
    }
  }
}

@media (-moz-pref("wireframe.pip.border_radius", 10)) {
  @-moz-document url("chrome://global/content/pictureinpicture/player.xhtml") {
    * {
      --wf-pip-control-radius: 10px;
    }
  }
}

/* === Picture-in-Picture Blur Effect Preference === */
@media -moz-pref("wireframe.pip.blur") {
  @-moz-document url("chrome://global/content/pictureinpicture/player.xhtml") {
    * {
      --wf-pip-control-bg: light-dark(rgba(239, 233, 217, 0.85), rgba(30, 30, 31, 0.85));
      --wf-pip-saturation: 1.5;
      --wf-pip-contrast: 1.2;
      --wf-pip-blur-radius: 20px;
    }
  }
}
